#!/usr/bin/env python3
"""
Interactive browser session using browser-use with persistent profile.
For agents to browse the web while maintaining login sessions.

Usage:
  browse "search for flights to tokyo"
  browse "go to gmail and check my inbox"
"""

import asyncio
import os
import sys

PROFILE_DIR = os.path.expanduser("~/.browser-profile")

async def main():
    if len(sys.argv) < 2:
        print("Usage: browse <task>")
        print('Example: browse "search for flights from berlin to tokyo in march"')
        sys.exit(1)

    task = " ".join(sys.argv[1:])

    from browser_use import Agent, Browser, BrowserConfig
    from langchain_anthropic import ChatAnthropic

    # Configure browser with persistent profile
    browser = Browser(
        config=BrowserConfig(
            chrome_instance_path="/usr/bin/google-chrome",
            # Use persistent profile
            extra_chromium_args=[
                f"--user-data-dir={PROFILE_DIR}",
                "--disable-blink-features=AutomationControlled",
            ],
            headless=not os.environ.get("DISPLAY"),
        )
    )

    # Use Claude for the agent
    llm = ChatAnthropic(
        model="claude-sonnet-4-20250514",
        timeout=60,
        stop=None,
    )

    agent = Agent(
        task=task,
        llm=llm,
        browser=browser,
    )

    print(f"Running task: {task}")
    result = await agent.run()
    print(f"\nResult: {result}")

    await browser.close()

if __name__ == "__main__":
    asyncio.run(main())
